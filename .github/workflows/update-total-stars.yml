name: Update Total Stars Count

on:
  # 1. æ¯å¤©è‡ªåŠ¨è¿è¡Œä¸€æ¬¡ (at 00:00 UTC)
  schedule:
    - cron: '0 0 * * *'
  # 2. å…è®¸ä½ æ‰‹åŠ¨åœ¨ "Actions" æ ‡ç­¾é¡µè§¦å‘
  workflow_dispatch:

# å…è®¸è¿™ä¸ª action å‘ä½ çš„ä»“åº“å†™å…¥å†…å®¹
permissions:
  contents: write

jobs:
  update-stars:
    runs-on: ubuntu-latest
    steps:
      # ç¬¬ 1 æ­¥: æ£€å‡ºä½ çš„ä»£ç  (ä¸ºäº†èƒ½è¿è¡Œ Python è„šæœ¬)
      - name: Check out main branch
        uses: actions/checkout@v4

      # ç¬¬ 2 æ­¥: è®¾ç½® Python ç¯å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # ç¬¬ 3 æ­¥: å®‰è£… Python ä¾èµ–åŒ…
      - name: Install dependencies
        run: pip install requests

      # ç¬¬ 4 æ­¥: è¿è¡Œ Python è„šæœ¬
      - name: Run Python script to calculate stars
        env:
          # âš ï¸ã€ã€ã€ ä½ éœ€è¦ä¿®æ”¹è¿™é‡Œ ã€‘ã€‘ã€‘ âš ï¸
          # æŠŠ 'YOUR_ORG_NAME_1' æ¢æˆä½ ç»„ç»‡çš„åå­—
          # å¦‚æœæœ‰å¤šä¸ªï¼Œç”¨é€—å·éš”å¼€, ä¾‹å¦‚: "kailinjiang,MyOrg1,MyOrg2"
          ACCOUNTS_TO_CHECK: "kailinjiang,MMKE-Bench,EVOKE,MINED-LMM,MLLMKCBENCH,KORE-LMM"
          
          # GITHUB_TOKEN ä¼šç”± GitHub Actions è‡ªåŠ¨æä¾›
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: python scripts/calculate_stars.py

      # ğŸ”´ğŸ”´ğŸ”´ æ–°å¢çš„ä¿®å¤æ­¥éª¤ ğŸ”´ğŸ”´ğŸ”´
      # åœ¨ commit ä¹‹å‰ï¼Œæ‰‹åŠ¨ä» main åˆ†æ”¯åˆ›å»º/åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯
      - name: Create or switch to branch
        run: git checkout -B google-scholar-stats

      # ç¬¬ 5 æ­¥: å°†ç”Ÿæˆçš„ total-stars.json æ–‡ä»¶æäº¤åˆ° google-scholar-stats åˆ†æ”¯
      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # æäº¤ä¿¡æ¯
          commit_message: 'docs: update total stars count'
          
          # è¦æäº¤çš„åˆ†æ”¯
          # (è™½ç„¶ä¸Šä¸€æ­¥å·²ç»åˆ‡æ¢äº†ï¼Œä½†è¿™é‡Œä»ç„¶æŒ‡å®šä»¥ç¡®ä¿æ¨é€åˆ°æ­£ç¡®çš„åœ°æ–¹)
          branch: google-scholar-stats
          
          # è¦æäº¤çš„æ–‡ä»¶
          file_pattern: total-stars.json
          
          # æäº¤è€…ä¿¡æ¯
          commit_user_name: github-actions[bot]
          commit_user_email: github-actions[bot]@users.noreply.github.com
